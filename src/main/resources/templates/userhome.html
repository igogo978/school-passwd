<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>useritem</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <script src="/passwd/public/js/vue.js"></script>
    <script src="/passwd/public/js/axios.min.js"></script>
    <style>

    </style>
</head>

<body id="LoginForm">
<div id="app">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-xxl d-flex align-items-md-center">
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="userhome">Home</a>
                    </li>
                </ul>
                <span class="navbar-text">
                       {{user.username}}
                    </span>
            </div>
        </div>
    </nav>

    <div class="album py-5 bg-gray">
        <div class="container">

            <section class="py-5 text-center container">
                <div class="row py-lg-5">
                    <div class="col-lg-6 col-md-8 mx-auto">
                        <p class="lead text-muted"> 檔案格式限定png,jpg</p>
                        <form method="POST" enctype="multipart/form-data"
                              th:action="@{'useritem/upload'}">
                            <div class="input-group mb-1">
                                <input type="file" name="file" class="form-control" aria-label="Sizing example input"
                                       aria-describedby="inputGroup-sizing-lg">
                                <button class="btn btn-outline-secondary"
                                        type="submit"
                                        value="Upload">確定上傳
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </section>

            <br>
           <h3>尚未設定 </h3>
            <div v-if="pendingitems.length > 0" class="row">

                <div class="col-md-4 col-sm-1" v-for="item in pendingitems">
                    <div class="card shadow-sm">

                        <img v-bind:src="'data:image/jpeg;base64,'+item['content'] " alt="Girl in a jacket"
                             width="100%" height="100%"/>
                        <div class="card-body">
                            <p class="card-text">covid-19防疫宣導{{item.id}}</p>

                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <button class="btn btn-outline-secondary" type="button" disabled>宣導期限（天）</button>
                                </div>
                                <select v-model="item.expired" class="form-select form-select-sm" aria-label="Default select example">
                                    <option v-for="day in days">{{day}}</option>
                                </select>
                            </div>

                            <div class="d-flex justify-content-between align-items-center">

                                <div class="btn-group">
                                    <button v-if="item.expired == 0" v-on:click="update(item)" type="button" class="btn btn-sm btn-outline-secondary" disabled>確定</button>
                                    <button v-else v-on:click="update(item)" type="button" class="btn btn-sm btn-outline-secondary">確定</button>
                                </div>
                                <button type="button" class="btn btn-sm btn-outline-danger">失效</button>
                                <!--                                <small class="text-muted">9 mins</small>-->
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <hr>
            <hr>
            <h3>上架中</h3>
            <div v-if="items.length > 0" class="row">

                <div class="col-md-4" v-for="item in items">
                    <div class="card shadow-sm">

                        <img v-bind:src="'data:image/jpeg;base64,'+item['content'] " alt="Girl in a jacket"
                             width="100%" height="100%"/>
                        <div class="card-body">
                            <p class="card-text">This is a wider card with supporting text below as a natural lead-in to
                                additional content. This content is a little bit longer.</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="btn-group">
<!--                                    <button type="button" class="btn btn-sm btn-outline-secondary">View</button>-->
                                    <button type="button" class="btn btn-sm btn-outline-secondary">Edit</button>
                                </div>
                                <small class="text-muted">9 mins</small>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        </div>
    </div>

</div>

<footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>

    <script th:inline="javascript">
      /*<![CDATA[*/


      Vue.prototype.$http = axios;
      let config = {
        headers: {
          'content-type': 'application/json;CHARSET=UTF-8'
        }
      };


      var app = new Vue({
        el: '#app',
        data: {
          user: /*[[${user}]]*/ {},
          pendingitems:[],
          items: [],
          msg: "nomsg",
          days: [3,7,30,60,90,180],
        },
        created: function () {
          // console.log(this.user.username.split("-")[1]);
          let vm = this;
          let url = "api/useritem/" + this.user.username;
          this.$http.get(url, config)
             .then(function (response) {
                 let items = response.data;
                 vm.pendingitems = items.filter((item)=>{
                       return item.expired == 0;
                 });

                 vm.items = items.filter((item)=>{
                       return item.expired != 0;
                 });

             })
             .catch(function (error) {
               /* 失敗，發生錯誤，然後...*/
             });


        },
        computed: {
        },
        methods: {
          submit: function () {

          },
          update: function(item) {
            let vm = this;
            let url = "api/useritem/update";
            this.$http.put(url, JSON.stringify(item), config).then((response) => {
              // success callback
              console.log(response.data);
              location.reload();

            }, (response) => {
              // error callback
            });

          }
        }
      })

      /*]]>*/


    </script>
</footer>

</body>

</html>