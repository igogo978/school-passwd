<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>admin home</title>


  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

   <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
   <script src="public/js/axios.min.js"></script>
  <style>

  </style>
</head>
<body>

<div class="container">
  <div id="app">


    <div th:insert="fragments/header.html :: navbar"></div>


    <br>
    <br>
    請選擇使用者
    <select v-model="item" class="form-select">
      <option v-for="user in users" v-bind:value="user">{{user.username}} {{user.name.substr(-1)}}</option>
    </select>

    <br>
    <br>
      <div class="col-md-10 mx-auto col-lg-12">
        <div class="p-4 p-md-5 border rounded-3 bg-light">
          <div class="form-floating mb-3">
            <small class="lead mb-4">帳號</small>
            <input v-model="item.username" type="text" class="form-control" id="floatingInput" placeholder="name@example.com" readonly>
          </div>


          <div v-if="item.name != undefined" class="form-floating mb-3">
            <small class="lead mb-4">姓名</small>
            <input v-model="item.name.substr(-1)" type="text" class="form-control" id="floatingInput" placeholder="name@example.com" readonly>
          </div>


          <div class="form-floating mb-3">
            <small class="lead mb-4">最大上架額度</small>
            <select v-model="item.quota" class="form-select" aria-label="Default select example">
            <option v-for="quota in quotas" :value="quota"> {{quota}} </option>
            </select>
          </div>


          <div v-if="item.roles != undefined" class="form-floating mb-3">
            <button v-if="item.roles.includes('admin')" v-on:click="updateRoles(item,'teacher')" class="w-100 btn btn-lg btn-warning" type="submit">移除管理者</button>
            <button v-else v-on:click="updateRoles(item,'admin')" class="w-100 btn btn-lg btn-danger" type="submit">設為管理者</button>
          </div>


          <button v-on:click="update(item)" class="w-100 btn btn-lg btn-primary" type="submit">更新</button>
          <hr class="my-4">
        </div>
      </div>
      <hr class="my-4">
  </div>
</div>

  <footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

    <script th:inline="javascript">
      /*<![CDATA[*/


      Vue.prototype.$http = axios;
      let config = {
        headers: {
          'content-type': 'application/json;CHARSET=UTF-8'
        }
      };

      var app = new Vue({
        el: '#app',
        data: {
          user: /*[[${user}]]*/ {},
          users: [],
          item: {},
          quotas: [0,1,2,3,4,5,6,7],
          msg: "update successfully",
        },
        created: function () {
          let vm = this;
          let url = "api/user";
          this.$http.get(url, config)
            .then(function (response) {
              console.log(response.data)
              vm.users = response.data;
              vm.item = vm.users[0];
            })
            .catch(function (error) {
              /* 失敗，發生錯誤，然後...*/
            });


        },
        computed: {
          updateMsg: function () {
          },
        },
        methods: {
          updateRoles: function(user, role) {
            let roles = [];
            roles.push('teacher')
            if(role == 'admin') {
              roles.push('admin');
            }
            user.roles = roles;
            console.log(user);

          },
          update: function (item) {
            let url = "api/user";

            this.$http.put(url, JSON.stringify(item), config).then((response) => {
                  // success callback
                  //console.log(response.data);
                  location.reload();

            }, (response) => {
                  // error callback
            });

          }
        }
      })

      /*]]>*/



    </script>
  </footer>

</body>

</html>